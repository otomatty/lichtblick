# Auto Bump Version ワークフロー

## 概要

mainブランチへのプッシュ時にバージョンを自動でパッチアップするワークフロー。
継続的な開発における小さな変更のバージョン管理を自動化。

## トリガー条件

- `main` ブランチへのプッシュ
- マージやダイレクトプッシュが発生した際に実行

## 実行内容

### 1. 環境セットアップ

- Ubuntu環境で実行
- Node.js 14を使用
- Yarnパッケージマネージャー有効化

### 2. 依存関係管理

- キャッシュを活用した高速インストール
- Skip-buildモードでのインストール（ビルドをスキップ）
- Immutableモード無効化（バージョン更新のため）

### 3. バージョン管理

- ルートpackage.jsonのpatchバージョンアップ
- `packages/suite/package.json`のpatchバージョンアップ
- 自動的に0.0.1単位で増加

### 4. Git操作

- GitHub Actionsボットとして設定
- バージョンファイルとロックファイルをコミット
- `[skip actions]`で無限ループを防止
- mainブランチへのプッシュ

### 5. 連携処理

- Pre-buildワークフローの手動トリガー
- GitHub API経由でのワークフロー実行

## 必要な設定

### シークレット

- `LICHTBLICK_GITHUB_TOKEN`: リポジトリ書き込み権限付きトークン
- `GITHUB_TOKEN`: API呼び出し用トークン

### 権限

- `actions: write`: 他のワークフロー実行権限

## 処理されるファイル

- `package.json` (root)
- `packages/suite/package.json`
- `yarn.lock`

## 注意点

- `[skip actions]`でワークフロー循環を防止
- Node.js 14使用（レガシーバージョン）
- Patchバージョンのみ自動アップ
- 失敗時は手動でのバージョン修正が必要

## ワークフロー連携

1. コードがmainブランチにマージ
2. 自動でバージョンアップ
3. Pre-buildワークフローを実行
4. ビルドファイルの事前生成

## 使用場面

- 小さなバグ修正
- 機能の微調整
- ドキュメント更新
- 設定ファイルの変更

## 制限事項

- Majorバージョンアップは手動
- Minorバージョンアップも手動
- リリース作業は別ワークフローで実行
- 緊急時のスキップ機能なし

## 改善提案

- Node.js版数の更新推奨
- セマンティックバージョニングの強化
- 条件分岐によるバージョンアップ種別の選択
